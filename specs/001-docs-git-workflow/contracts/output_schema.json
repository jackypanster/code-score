{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schemas.code-score.dev/metrics-output/v1.0.0",
  "title": "Git Repository Metrics Output Schema",
  "description": "Standardized schema for repository analysis results",
  "type": "object",
  "required": ["repository", "metrics", "execution"],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Schema version for compatibility validation"
    },
    "repository": {
      "type": "object",
      "required": ["url", "commit", "language", "timestamp"],
      "properties": {
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Git repository URL"
        },
        "commit": {
          "type": "string",
          "pattern": "^[a-f0-9]{40}$",
          "description": "Git commit SHA"
        },
        "language": {
          "type": "string",
          "enum": ["python", "javascript", "typescript", "java", "go", "unknown"],
          "description": "Primary programming language detected"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Analysis timestamp in ISO 8601 format"
        },
        "size_mb": {
          "type": "number",
          "minimum": 0,
          "description": "Repository size in megabytes"
        }
      },
      "additionalProperties": false
    },
    "metrics": {
      "type": "object",
      "required": ["code_quality", "testing", "documentation"],
      "properties": {
        "code_quality": {
          "type": "object",
          "properties": {
            "lint_results": {
              "type": "object",
              "properties": {
                "tool_used": {"type": "string"},
                "passed": {"type": "boolean"},
                "issues_count": {"type": "integer", "minimum": 0},
                "issues": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["severity", "message", "file", "line"],
                    "properties": {
                      "severity": {"type": "string", "enum": ["error", "warning", "info"]},
                      "message": {"type": "string"},
                      "file": {"type": "string"},
                      "line": {"type": "integer", "minimum": 1},
                      "column": {"type": "integer", "minimum": 1}
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            },
            "build_success": {
              "type": "boolean",
              "description": "Whether the project builds successfully"
            },
            "security_issues": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["severity", "title", "description"],
                "properties": {
                  "severity": {"type": "string", "enum": ["critical", "high", "medium", "low"]},
                  "title": {"type": "string"},
                  "description": {"type": "string"},
                  "cve_id": {"type": "string"},
                  "affected_package": {"type": "string"}
                },
                "additionalProperties": false
              }
            },
            "dependency_audit": {
              "type": "object",
              "properties": {
                "vulnerabilities_found": {"type": "integer", "minimum": 0},
                "high_severity_count": {"type": "integer", "minimum": 0},
                "tool_used": {"type": "string"}
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "testing": {
          "type": "object",
          "properties": {
            "test_execution": {
              "type": "object",
              "properties": {
                "tests_run": {"type": "integer", "minimum": 0},
                "tests_passed": {"type": "integer", "minimum": 0},
                "tests_failed": {"type": "integer", "minimum": 0},
                "framework": {"type": "string"},
                "execution_time_seconds": {"type": "number", "minimum": 0}
              },
              "additionalProperties": false
            },
            "coverage_report": {
              "type": "object",
              "properties": {
                "line_coverage": {"type": "number", "minimum": 0, "maximum": 100},
                "branch_coverage": {"type": "number", "minimum": 0, "maximum": 100},
                "function_coverage": {"type": "number", "minimum": 0, "maximum": 100},
                "tool_used": {"type": "string"}
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "documentation": {
          "type": "object",
          "properties": {
            "readme_present": {"type": "boolean"},
            "readme_quality_score": {"type": "number", "minimum": 0, "maximum": 1},
            "api_documentation": {"type": "boolean"},
            "setup_instructions": {"type": "boolean"},
            "usage_examples": {"type": "boolean"}
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "execution": {
      "type": "object",
      "required": ["tools_used", "duration_seconds", "timestamp"],
      "properties": {
        "tools_used": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of analysis tools executed"
        },
        "errors": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Errors encountered during execution"
        },
        "warnings": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Warnings generated during execution"
        },
        "duration_seconds": {
          "type": "number",
          "minimum": 0,
          "description": "Total execution time in seconds"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Execution completion timestamp"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}